<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adicionar Saldo</title>
    <style>
        /* Estilos do body e dos botões... */
    </style>
</head>
<body>
    <div class="container">
        <div class="buttons">
            <button class="button" onclick="adicionarSaldo(25)">25,00 R$</button>
            <button class="button" onclick="adicionarSaldo(50)">50,00 R$</button>
            <button class="button" onclick="adicionarSaldo(100)">100,00 R$</button>
            <button class="button" onclick="adicionarSaldo(250)">250,00 R$</button>
            <button class="button" onclick="adicionarSaldo(500)">500,00 R$</button>
            <button class="button" onclick="adicionarSaldo(1000)">1000,00 R$</button>
        </div>

        <div class="bonus-text" id="bonus-text" style="display: none;">
            Adicionando mais de 500,00 R$, você recebe 25% de bônus!
        </div>

        <div class="montante-container">
            <div>
                <span>O SEU MONTANTE</span>
                <input type="text" id="input-value" placeholder="0,00 R$">
            </div>
            <div>
                <span>VOCÊ VAI RECEBER</span>
                <div id="receber-value">0,00 R$</div>
            </div>
        </div>

        <button class="pay-button" onclick="confirmarPagamento()">Pagar</button>
    </div>

    <script type="module">
        import { db } from './firebase-config.js';
        import { doc, getDoc, updateDoc } from "firebase/firestore";

        const userId = "1"; // ID do documento no Firestore

        async function buscarSaldo() {
            const docRef = doc(db, "usuarios", userId);
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) {
                return docSnap.data().saldo;
            } else {
                alert("Usuário não encontrado.");
                return 0;
            }
        }

        async function atualizarSaldoDisplay() {
            const saldoAtual = await buscarSaldo();
            const saldoDisplay = document.getElementById("saldo-display");
            saldoDisplay.textContent = `${saldoAtual.toFixed(2).replace('.', ',')} R$`;
            saldoDisplay.style.transform = "scale(1.2)";
            setTimeout(() => {
                saldoDisplay.style.transform = "scale(1)";
            }, 200);
        }

        function adicionarSaldo(valor) {
            document.getElementById("input-value").value = valor.toFixed(2).replace('.', ',') + " R$";
            calcularReceber(valor);
        }

        function calcularReceber(valor) {
            const receberElement = document.getElementById("receber-value");
            const confirmarValor = document.getElementById("confirmar-valor");
            const bonusText = document.getElementById("bonus-text");

            let valorFinal = valor;
            let bonus = 0;

            if (valor > 500) {
                bonus = valor * 0.25; // Calcula 25% de bônus
                valorFinal += bonus;
                bonusText.style.display = "block"; // Mostra o aviso de bônus
            } else {
                bonusText.style.display = "none"; // Esconde o aviso
            }

            receberElement.textContent = valorFinal.toFixed(2).replace('.', ',') + " R$";
            confirmarValor.textContent = valorFinal.toFixed(2).replace('.', ',') + " R$";
        }

        async function confirmarPagamento() {
            const montanteInput = document.getElementById("input-value").value.replace(",", ".");
            const valor = parseFloat(montanteInput);

            if (isNaN(valor) || valor <= 0) {
                alert("Por favor, insira um valor válido!");
                return;
            }

            let valorFinal = valor;

            if (valor > 500) {
                valorFinal += valor * 0.25; // Adiciona bônus de 25%
            }

            const confirmacao = confirm(`Você está prestes a adicionar ${valorFinal.toFixed(2).replace('.', ',')} R$. Deseja continuar?`);
            if (!confirmacao) return;

            await atualizarSaldo(valorFinal);
            window.location.href = "index.html"; // Retorna à página principal
        }

    </script>

</body>
</html>
